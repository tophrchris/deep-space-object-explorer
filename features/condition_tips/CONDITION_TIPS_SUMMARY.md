# Condition Tips Summary

This document describes the condition tips currently generated by `condition_tips/engine.py`.

## Rendering levels

- `opportunity`
  - Rendered as a dark-blue highlight block with white text.
  - Highest priority in the list (shown before warnings and bullets).
- `warning`
  - Rendered as a pale-yellow highlight block prefixed with `Warning:`.
  - Shown after any opportunities.
- `bullet` (default)
  - Rendered as a standard bullet line.
- `strong`
  - Rendered as a bold bullet line.
- `muted`
  - Rendered as subdued caption text under the bullets.

## Rule execution order

Rules run in this order:

1. `sky_cover`
2. `clear_window`
3. `precip`
4. `wind`
5. `dewpoint`
6. `humidity`
7. `temp_drop`
8. `temp`

## Tip rules and thresholds

## `sky_cover` (`muted`)

- Input: hourly `cloud_cover`
- Logic: average cloud cover over the selected night
- Output bands:
  - `<= 25%`: mostly clear
  - `<= 50%`: partly cloudy
  - `<= 75%`: elevated cloud cover
  - `> 75%`: likely heavy cloud cover
- If missing: `Sky cover outlook unavailable.`

## `clear_window` (`opportunity` for long windows, otherwise `bullet`; `muted` if unavailable)

- Input: hourly `cloud_cover`, `time_iso`
- Logic:
  - Finds the longest consecutive hourly run where `cloud_cover < 20%`.
  - Run duration is formatted as `HH:MM`.
- Output:
  - If found: `Longest clear-sky window (<20% clouds): start-end (HH:MM).`
  - If longest clear window is `>= 5:00`, this tip is rendered as an `opportunity`.
  - If none: `No clear-sky window under 20% cloud cover is expected.`
  - If data missing: `Clear-sky window is unavailable.` (`muted`)

## `precip` (`warning` for accumulation alerts, otherwise `muted`)

- Inputs: `precipitation_probability`, `rain`, `showers`, `snowfall`
- Snow accumulation:
  - If total snowfall `> 0`: warning with `❄️`.
- Liquid accumulation:
  - If total liquid (`rain + showers`) `> 0`:
    - Warning only when projected accumulation exceeds `0.1` in the active display units.
      - Metric mode: `> 0.1 mm`
      - Imperial mode: `> 0.1 in` (converted internally to mm threshold)
    - Uses emoji prefix:
      - `⛈️` when rain contributes
      - `☔` when showers-only
    - If at or below threshold, emits a muted "trace rain/showers possible" tip.
- If no accumulation:
  - `>= 40%` max probability: muted elevated probability message
  - `>= 20%` max probability: muted low-end risk
  - otherwise muted low-risk message
- If missing: `Precipitation outlook unavailable.` (`muted`)

## `wind` (`bullet` + inline advice, otherwise `muted`)

- Input: hourly `wind_gusts_10m`
- Logic:
  - Peak gust `>= 45 km/h`: bullet with inline bold advice to shorten sub-exposures.
  - Peak gust `>= 30 km/h`: muted moderate gusts.
  - Else: muted manageable winds.
- If missing: `Wind outlook unavailable.` (`muted`)

## `dewpoint` (`bullet` + inline advice, `muted` if unavailable)

- Inputs: hourly `temperature_2m`, `dew_point_2m`
- Logic:
  - Uses minimum absolute spread `|temp - dewpoint|`.
  - Threshold checks are evaluated using Fahrenheit-equivalent bands.
  - Displayed spread uses active unit (`C` or `F`).
- Output bands:
  - `<= 2 F` (about `<= 1 C`): high risk of dew accumulation, use Heater and Dew Shield to avoid fogging
  - `2-5 F` (about `1-3 C`): dew likely, consider dew shield and heater, battery permitting
  - `> 5 F` (about `> 3 C`): low risk of dew, heater/shield optional
- If missing: `Dewpoint spread unavailable.` (`muted`)

## `humidity` (`warning` or `bullet`, otherwise `muted`)

- Input: hourly `relative_humidity_2m`
- Logic: uses peak relative humidity during the selected night
- Output bands:
  - `> 85%`: warning with astrophotography guidance:
    - prefer bright emission targets
    - avoid faint galaxies
    - expect stronger gradients
  - `>= 65%`: bullet recommending anti-dew heater
  - `< 65%`: muted moderate-humidity message
- If missing: `Relative humidity outlook unavailable.` (`muted`)

## `temp_drop` (`bullet`, `muted` if unavailable)

- Input: hourly `temperature_2m`, `time_iso`
- Logic:
  - Computes:
    - maximum overnight cooling drawdown from running high
    - steepest adjacent-interval cooling rate and time window
  - Refocus thresholds are evaluated in Fahrenheit:
    - max overnight drop `>= 5.0 F`, or
    - steepest rate `> 2.0 F/hr`
- Output:
  - Includes steepest cooling rate, time window, interval drop, and max overnight drop.
  - If threshold met: includes inline bold refocus guidance to avoid bloated stars.
  - If not met: explicitly says no need to refocus.
- If insufficient data: muted cooling unavailable message.

## `temp` (`muted`)

- Inputs:
  - Prefers summary row value `Low-Hi` (fallback `Temp Range`)
  - Otherwise computes from hourly `temperature_2m`
- Output:
  - `Temperature range: low-high unit.`
- If no data: no tip emitted.

## Fallback behavior

- If there are no hourly rows at all, only one muted tip is returned:
  - `Hourly weather for this period is unavailable.`
